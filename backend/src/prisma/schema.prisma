// Prisma schema for Expense Tracker
// Uses PostgreSQL with precise money handling

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  // Temporarily removed directUrl - using same connection for migrations
  // directUrl = env("DIRECT_URL")
}

// Main expense model with precise decimal for money
model Expense {
  id          String   @id @default(uuid())
  amount      Decimal  @db.Decimal(12, 2) // Exact money storage, no floating point
  category    String   // Required - expense category
  description String   // Required - expense description
  date        DateTime // Date-only, stored as midnight UTC for consistency
  createdAt   DateTime @default(now()) @db.Timestamptz(6)
  updatedAt   DateTime @updatedAt @db.Timestamptz(6)

  @@index([category]) // For filtering by category
  @@index([date(sort: Desc)]) // For sorting by date descending
  @@index([createdAt(sort: Desc)]) // For default ordering
  @@map("expenses")
}

// Idempotency store for handling duplicate requests
model IdempotencyStore {
  id        String   @id @default(uuid())
  key       String   @unique // The idempotency key from client
  response  Json // Cached response to return for duplicate requests
  createdAt DateTime @default(now())
  expiresAt DateTime // TTL for cleanup (24 hours)

  @@index([expiresAt]) // For cleanup queries
  @@map("idempotency_store")
}
